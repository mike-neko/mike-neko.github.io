+++
categories = ["server"]
tags = ["docker", "db"]
date = "2016-09-29T01:44:58+09:00"
draft = false
slug = "docker-db"
title = "Docker(Kitematic)+PHPStormでMySQL環境をお手軽構築"

+++

個人的には`MariaDB`を使っているが、レンタルサーバや既存開発のものだと
まだまだ`MySQL`の環境が必要なこともしばしば。。。

かといって、そんなに使わない環境をわざわざローカルに構築するのも面倒なので、
さっくりとお手軽に速攻で構築してしまおうという時のメモ

<!--more-->

ちなみに、お手軽なのでターミナルでコマンドを叩くことすらしない  

## 手順
### 前提条件
- `Docker`と`Kitematic`をインストールしておく
- `PhpStorm`をインストールしておく

> 参考：[Docker構築メモ](../docker/)

※`PhpStorm`は接続確認や`phpMyAdmin`の代わりに使うので、なくてもDB構築には支障ない

### MySQLの構築
#### コンテナの生成
1. `Kitematic`を起動する
1. 検索窓(`Serach for Docker ...`とあるところ)にmysqlで検索し、
作者が`official`になっている`mysql`のイメージを見つける
1. *（バージョンを指定したい時のみ）*  
CREATEボタンの左にある`・・・` - `SELECTED TAG`から任意のバージョンを選択
1. `CREATE`を実行してしばらく待つとコンテナが生成される

※この段階ではパスワードなど必要な設定がまだの為、エラーで起動しない

#### MySQLの設定
DBの設定は、

- rootパスワード:`root`
- データベース名:testdb
- ユーザ名:user
- パスワード:pass
- ポート:32768

という前提のため適宜読み替えること

1\. `Settings`のタブを選択  
2\. `Environment Variables`に以下のように設定値を追加

KEY | VALUE |   |
--- | ----- | --- |
MYSQL_ROOT_PASSWORD | root | rootパスワード 
MYSQL_DATABASE | testdb | データベース名 
MYSQL_USER | user | ユーザ名 
MYSQL_PASSWORD | pass | パスワード 

3\. `SAVE`を押す（**忘れないこと**）  
4\. `Ports`のタブを選択  
5\. `MAC IP:PORT`の項目の下に`Docker`のIPアドレスが表示されているので、
`:`の後ろにポート番号を入れる  
6\. `SAVE`を押す（**忘れないこと**）  
7\. 再起動がかかるはずなので、`Home`のタブを選択  
8\. ログに`mysqld: ready for connections.`と出ていればOK  
9\. 右側の`ACCESS URL`のIPアドレスを確認しておく

※ポートの指定をしない場合は、適当なポートが割り振られ、
起動毎にポートが変わる可能性があるので指定しておくこと

### 接続確認
1\. `PhpStorm`で適当なプロジェクトを作って起動  
2\. メニューの`View` - `Tool Windows` - `Database`を選択  
3\. ツールウィンドウの左上の`+` - `Data Source` - `MySQL`を選択  

項目 | 設定値 |   |
--- | ----- | --- |
Host | 192.168.99.100 | 前項9で確認したIPアドレス
Port | 32768 | 前項5で指定したポート 
Database | testdb | データベース名 
User | user | ユーザ名 
Password | pass | パスワード 

4\. `Test Connection`を押して`Successful`と出れば接続OK  
5\. `Options`タブを選択  
6\. `Resolve ...`の欄でDB名にチェックを入れる  
7\. `OK`で閉じるとツールウィンドウ内にDBが表示される

あとはPhpStormのGUIでDB内のデータを表示や操作させたり、SQLを実行したり自由にできる

## 感想
頻繁に使うものならともかく、使い捨てやまれなものは、やっぱりGUIで操作できると助かる

特に今回は`PhpStorm`を使って、実際の開発環境でDBの確認や操作が楽にするのがポイント

`PhpStorm`はアップデートも早いし機能も豊富で素晴らしいツール！
ただ、もうちょっと日本語の資料が多いとありがたい（他力本願）

# 開発環境
- macOS 10.12.0
- PhpStorm 2016.2