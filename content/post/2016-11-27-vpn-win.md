+++
categories = ["server"]
tags = ["db", "centos"]
date = "2016-11-27T22:50:47+09:00"
draft = false
slug = "vpn-win"
title = "VPN上のWindows機へ接続"

+++

`SSH`が入っていないVPN上のWindowsへアクセスする方法

<!--more-->

この場合、踏み台となる`SSH`が入った別のマシンが必要となる

今回の検証環境は以下の通り

- ローカル：Mac OS 10.11(※)
- VPN
  - CentOS 6.8(踏み台)
  - Windows(SQLServer)

*※ macOS 10.12(sierra)は`PPTP`でのVPN接続がOSではサポートされていないので注意！*

接続のイメージは以下の通り
```
    Mac
     |
(VPN / SSH)
     |
   CentOS(192.168.10.1 / 踏み台) - Windows(192.168.10.2 / SQLServer)
```

## RemoteDesktopでログイン
Windowsなので遠隔で操作するには`RemoteDesktop`を利用

### SSHの接続方法
以下の形式でSSH接続する
```
ssh -C -L 3389:(WindowsのIP):3389 (踏み台のIP)
```

例えば、上述の環境でCentOSの`user`でログインする場合だと、
```
ssh -C -L 3389:192.168.10.2:3389 user@192.168.10.1
```
で接続する

### RemoteDesktopの設定
- PC name:`localhost`
- User name: Windowsのユーザ名
- Password: Windowsのパスワード

ポイントはホストが`localhost`になること

## SQL Serverへ接続
### SSHの接続方法
以下の形式でSSH接続する
```
ssh -C -L (DBのポート):(WindowsのIP):(DBのポート) (踏み台のIP)
```

例えば、上述の環境でCentOSの`user`、SQLServerのポートが`1433`でログインする場合だと、
```
ssh -C -L 1433:192.168.10.2:1433 user@192.168.10.1
```
で接続する

### DB接続設定
- ホスト:`localhost`
- ポート:1433
- DB名: そのまま
- DBユーザ: そのまま
- DBパスワード: そのまま

