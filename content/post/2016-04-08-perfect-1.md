+++
categories = ["old"]
tags = ["swift2"]
date = "2016-04-08T22:25:06+09:00"
draft = false
slug = "perfect-1"
title = "Perfect 導入編"

+++

サーバーサイドSwiftフレームワークの[Perfect](https://perfect.org/)の使い方のメモその1

導入編ではベースとなるプロジェクトを一から作るあたりまで

<!--more-->

## きっかけ
Perfectがついに1.0になったというのを聞きつけてGitHubのREADMEを見てると、、、

> **WebSockets & iOS Push Notifications**
>
> Perfect now includes a **WebSockets** server and support for handling your own server-side **iOS push notifications**.

ってのを発見！

ちょうど、Push通知周りの実験をしたかったこともあり、さっそく手を出すことに〜

## 手順
### 下準備
#### [GitHub](https://github.com/PerfectlySoft/Perfect)からPerfectをダウンロードする
ダウンロードしたら適当な場所に展開しておく
#### Xcodeにテンプレートを追加
1. `~/Library/Developer/Xcode`をFinderで開く
2. `Xcode`直下に(無ければ)`Templates`というフォルダを作成
3. その`Templates`直下に(無ければ)`Project Template`というフォルダを作成
4. ダウンロードしておいたPerfectのプロジェクトの中（`Perfect-master/Extras/Xcode Templates/Perfect/`）にある`Perfect Server Framework.xctemplate`のフォルダを丸ごとコピー
5. 3で作ったフォルダに4のフォルダを貼り付け

### プロジェクトの作成
*ワークスペース名：`SmapleBasePerfect`  
 プロジェクト名：`SampleServer`*  
で作成する前提での手順

#### ワークスペースの作成
1. Xcodeのメニューの`File`-`New`-`Workspace...`を選択
1. ワークスペース名と保存先のフォルダを選択(作成)して`Save`  
（ワークスペースはプロジェクトと違ってフォルダは自動作成されないので注意）

自動で空のワークスペースの画面が開かれるので、そのままの状態で次の手順へ

#### プロジェクトの作成
1. Xcodeのメニューの`File`-`New`-`Project...`を選択
1. 左側の`OS X`-`Project Template`の中から`Perfect Server Framework`を選択して`Next`（下図）
{{< img "template.png" >}}
1. プロジェクト名などを適宜入力して`Next`  
（プロジェクト名はワークスペースと同じにできない）
1. `Add to:`でワークスペース名を選択する  
1. 保存先を選択して`Create`

デフォルトで下のようなプロジェクトが生成される
{{< img "project.png" >}}

#### Perfectを追加
1. ダウンロードしておいたPerfectのプロジェクト直下にある`PerfectLib`と`PerfectServer`のフォルダを丸ごとコピー
2. プロジェクトのフォルダと同じ階層に貼り付け
3. XcodeのProject Navigator(上のイメージの部分)の何もないところで右クリック
4. 出てきたメニューから`Add files to "ワークスペース名"...`を選択  
（もしプロジェクト名が出てきたら3からやり直し）
5. `Copy items into ...`はチェック無、`Create groups ...`にチェック有にする  
（無い場合は`Option`をクリック）
6. 1と2でコピーしたフォルダの中から`PerfectLib.xcodeproj`を選択して`Add`  
7. `PerfectServer.xcodeproj`についても3からの同じ手順で追加

#### スキームの設定
1. Xcodeのメニューの`Product`-`Scheme`-`Manage Schemes...`を選択
1. プロジェクト名と同じスキームを選択して`Edit...`を選択
1. 左側で`Run`、右側の`Info`タグを選択
1. `Executable`で`PerfectServer HTTP.app`を選択
1. 下の方にある`Shared`にチェック
1. `Close`で閉じる

#### フレームワークの追加
1. 作成したプロジェクトを選択
1. `TARGETS`でプロジェクト名と同じもの、`General`タブを選択
1. `Linked Frameworks and Libraries`の`＋`を選択
1. `PerfectLib.framework`で`OSX`の方を選択して`Add`
{{< img "framework.png" >}}

#### ドキュメントを配置
1. `Build Phases`タブを選択
1. 左上の`＋`をクリックして、`New Copy Files Phases`を選択
1. `Destination`で`Products Directory`を選択  
`Subpath`に`webroot`と入力
1. `Name`の下の方にある`＋`をクリックし、`index.mustache`を選択して`Add`  


## 動作確認
Xcodeで`SampleServer`のスキームで`Run`して、GUIが立ち上がるとサーバが動作した状態となる

その状態で`http://0.0.0.0:8181/`にアクセスして、「Hello, world!」と出ればひとまずOK

# 感想
意外に日本語の、特にMac上で動かす場合の資料が少なくて苦労した  
それとこういうのを触る度にサーバ周りの知識が足りないのを痛感する・・・

# 参考リンク
- [Create a Perfect Swift Server Project(from scratch) in Xcode](http://code-me-dirty.blogspot.jp/2016/02/creating-perfect-swift-server.html)

# 開発環境
+ OS X 10.11.4
+ Xcode 7.3

# ソース
[こちら](https://github.com/mike-neko/SampleBasePerfect)

- Perfect 基礎編[その2](../perfect-2/)
- Perfect APNs編[その3](../perfect-push/)
