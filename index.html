<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>M.Ikeの小ネタ集 &middot; M.Ike</title>

  
  <link rel="stylesheet" href="https://mike-neko.github.io/css/poole.css">
  <link rel="stylesheet" href="https://mike-neko.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://mike-neko.github.io/css/poole-overrides.css">
  <link rel="stylesheet" href="https://mike-neko.github.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="https://mike-neko.github.io/css/hyde-x.css">
  <link rel="stylesheet" href="https://mike-neko.github.io/css/highlight/xcode.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link href="https://mike-neko.github.io/favicon.png" rel="icon">

  
  
  
  <link href="https://mike-neko.github.io/index.xml" rel="alternate" type="application/rss+xml" title="M.Ikeの小ネタ集 &middot; M.Ike" />

  <meta name="description" content="">
  <meta name="keywords" content="">
  
</head>
<body class="theme-base-0d layout-reverse">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1>M.Ike</h1>
      <p class="lead">〜小ネタ集〜</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https://mike-neko.github.io/">Tips</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/mike-neko"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      
      
      
      <a href="https://twitter.com/m__ike_"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      
      </li>
    </ul>


    <p>Copyright &copy; 2016 <a href="https://mike-neko.github.io/license/">M.Ike</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
  </div>
</div>


<div class="content container">
  <div class="posts">
    
    
    <div class="post">
      <h1 class="post-title">
        <a href="https://mike-neko.github.io/blog/metal%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%9D%E3%81%AE1/">Metalサンプル(その1)</a>
      </h1>
      <span class="post-date">Jan 22, 2016
      
      <br/>
      <a class="label" href="https://mike-neko.github.io/categories/ios">ios</a><a class="label" href="https://mike-neko.github.io/categories/metal">metal</a><a class="label" href="https://mike-neko.github.io/categories/code">code</a>
      </span>
      
      概要 元ネタは、Apple公式のMetalKitEssentialsでこれをSwiftで書き直し＋αしたもの。 内容は主にMetalKitを使って、obj形式のモデルをテクスチャありで表示させるだけ。 シェーダもいたってシンプルでライトもなし。 ちなみに、MetalKitはiOS9以降でしか使えないので注意。 小ネタ はじめに 一番最初につまずいたのは、ビルド自体が通らず、Metalのフレームワークのインポートでエラーになる！ってこと。当然、コードを書く時にも自動補完は効かないしエラーでまくるし・・・ で、原因はターゲットでシュミレータを選択していたこと。実行できないのは知っていたけど、まさかビルドすら通らないのは予想外。。。 バッファへのアクセス 今回、一番書き方が判らなくて苦労したのがこれ。単にVertexBufferへのポインタを取得して、中のデータを読み書きしたいだけなのだが、当然、Swiftがメモリへの直アクセスを許してくれるわけはなく・・・ 上がObjective-Cで書いた場合で下がSwiftの場合： Swiftでは、まずポインタpを明示的に取得し、それからmemory()でVertexUniformsの型へ変換し、それを通して中のデータへアクセスするという手間が必要。やはりSwiftは型にうるさい。 なお、このサンプルでは配列ではないのでp.memory()だが、バッファの内容が配列になっていてインデックスでアクセスしたい場合は、p.advancedBy(i).memory()(iがインデックス)とする。 ちょっと面倒だけど、暗黙的な「わかる人にはわかる」といった曖昧さを排除し、ポインタの状態やメモリにアクセスしていることを明示させているのは、Swiftの良さの一つだと思う。 シェーダ用の構造体 今回、シェーダにデータを渡す時の型（構造体）を、シェーダのファイルとSwift上でそれぞれ同じ宣言をしている。これは、Swiftから直接Cのファイルを見に行けない為。ブリッジヘッダを使ったりすれば重複して宣言しなくてよさそうだけど、未検証。Swift上ではSwiftの構造体を使えた方が便利かなと思ったので（結局使わなかったけど） なお、当然ながらメモリのアライメントには注意が必要(公式:アライメント一覧)なので、必要に応じてパディングすること。ちなみに忘れると画面が心霊現象みたくなったり表示されなかったり・・・ SIMD Xcode7からようやくSIMDがサポート。これでvectorやmatrixのベタなコードを書く or 持ってくる必要がなくなった。（でも移動や回転とかはやっぱり自前が必要） import simdで使えるようになる。MetalKitのインポートでも良い。 感想 正直なところ、Unityとかに慣れてしまった身にとって、Metalは結構大変だった。。。日本語の資料も少ないし、公式の資料もまだまだObjective-Cが多い感じ。 といっても、DirectXのダラダラとした初期化とかに比べると、機種依存がなく簡潔で楽。久々に3Dの基礎を振り返る良い機会になったと思う。 結局まあ、Unityとかが偉大すぎるという当たり前の結論に到達。 触っていて、良い！と思ったのは、バグで描画がおかしくなったりしても、影響が端末だけに限られて作業しているMacは無事なこと。 昔々のDirectXでしょっちゅうブルースクリーンを出してしまい、コードが消えたりPC不安定になっていた人なので、これはとても助かった。 ソース こちら 開発環境 Xcode 7.2 iOS 9.2 iPhone 6+
      
      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="https://mike-neko.github.io/blog/hugo%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95%E3%83%A1%E3%83%A2/">Hugo利用方法メモ</a>
      </h1>
      <span class="post-date">Jan 20, 2016
      
      <br/>
      <a class="label" href="https://mike-neko.github.io/categories/github">github</a><a class="label" href="https://mike-neko.github.io/categories/%E3%83%A1%E3%83%A2">メモ</a>
      </span>
      
      <p>初めはOctopressを使ってたものの、シンタックスハイライトがどうもうまく好みにならなかったので、結局、１週間ほどでHugoに乗り換え。Octopressに比べると構成もわかりやすいし、最新の資料が多くてよかった。<br />
テーマはなるべくシンプル、かつ、スマホでも見やすい<a href="http://themes.gohugo.io/hyde-x/">Hyde-X</a>を選定。以下はHyde-Xの場合の設定なので、他のテーマでは変わるので注意。</p>

<h2 id="初期設定:8d244dac89903f7d90007c69acaf707d">初期設定</h2>

      <a href="https://mike-neko.github.io/blog/hugo%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95%E3%83%A1%E3%83%A2/">Read On &rarr;</a>
      
    </div>
    
    
    
  </div>
</div>


<script src="https://mike-neko.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>

